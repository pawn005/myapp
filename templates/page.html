<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Mathematical Animations</title>
<style>
  body { margin:0; background:black; color:white; font-family:sans-serif; overflow:hidden; }
  .header { display:flex; align-items:center; padding:10px; font-size:1.2em; position:absolute; top:0; left:0; width:100%; z-index:10; }
  #backBtn { cursor:pointer; margin-right:10px; color:white; }
  #piCanvas { display:block; position:absolute; top:0; left:0; width:100%; height:100%; }
  .fade { transition: opacity 0.5s; }
</style>
</head>
<body>
<div class="header">
  <span id="backBtn">BACK</span>
  <span class="page-id" id="pageId">000</span>
</div>
<canvas id="piCanvas" class="fade"></canvas>

<script>
const canvas = document.getElementById("piCanvas");
const ctx = canvas.getContext("2d");

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

document.getElementById("backBtn").addEventListener("click", ()=> {
  window.location.href="{{ url_for('index') }}";
});

let page_id = 0;
let raf;

// --- 各ページ描画関数 ---
// 0: 円周率
let step0=0;
const pi_digits="14159265358979323846264338327950288419716939937510";
function drawPage0(){
  ctx.fillStyle="rgba(0,0,0,0.1)"; ctx.fillRect(0,0,canvas.width,canvas.height);
  const centerX=canvas.width/2, centerY=canvas.height/2;
  const digit=parseInt(pi_digits[step0]);
  const angle=digit*36*Math.PI/180;
  const length=200;
  const x=centerX+length*Math.cos(angle);
  const y=centerY+length*Math.sin(angle);
  ctx.strokeStyle="white"; ctx.lineWidth=2;
  ctx.beginPath(); ctx.moveTo(centerX,centerY); ctx.lineTo(x,y); ctx.stroke();
  step0=(step0+1)%pi_digits.length;
  raf=requestAnimationFrame(drawPage0);
}

// 1: 色ブロック
let frame1=0;
function drawPage1(){
  ctx.fillStyle="rgba(0,0,0,0.2)"; ctx.fillRect(0,0,canvas.width,canvas.height);
  const blockSize=50;
  const cols=Math.floor(canvas.width/blockSize), rows=Math.floor(canvas.height/blockSize);
  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      const hue=(frame1+r*20+c*10)%360;
      ctx.fillStyle=`hsl(${hue},80%,60%)`;
      ctx.fillRect(c*blockSize,r*blockSize,blockSize-2,blockSize-2);
    }
  }
  frame1+=2;
  raf=requestAnimationFrame(drawPage1);
}

// 2: ピラミッド
let frame2=0;
function drawPage2(){
  ctx.fillStyle="rgba(0,0,0,0.2)"; ctx.fillRect(0,0,canvas.width,canvas.height);
  const blockSize=40, base=10;
  const offsetX=canvas.width/2, offsetY=canvas.height-50;
  const colorSeed=Math.floor(Date.now()/100)%360;
  for(let row=0;row<base;row++){
    for(let col=0;col<base-row;col++){
      if(frame2/5>=row){
        const hue=(colorSeed+row*40+col*60)%360;
        ctx.fillStyle=`hsl(${hue},80%,60%)`;
        const x=offsetX-(base-row)*blockSize/2+col*blockSize;
        const y=offsetY-row*blockSize;
        ctx.fillRect(x,y,blockSize-2,blockSize-2);
      }
    }
  }
  frame2++;
  if(frame2>base*10) frame2=0;
  raf=requestAnimationFrame(drawPage2);
}

// 3: リサジュー
let t3=0;
function drawPage3(){
  ctx.fillStyle="rgba(0,0,0,0.05)"; ctx.fillRect(0,0,canvas.width,canvas.height);
  const A=200,B=150,a=3,b=2,delta=Math.PI/2;
  const x=canvas.width/2 + A*Math.sin(a*t3 + delta);
  const y=canvas.height/2 + B*Math.sin(b*t3);
  ctx.fillStyle=`hsl(${t3*50%360},80%,60%)`;
  ctx.beginPath(); ctx.arc(x,y,5,0,Math.PI*2); ctx.fill();
  t3+=0.02;
  raf=requestAnimationFrame(drawPage3);
}

// 4: フラクタルツリー
function drawFractalTree(x1,y1,angle,depth){
  if(depth===0) return;
  const x2=x1+Math.cos(angle)*depth*10;
  const y2=y1-Math.sin(angle)*depth*10;
  ctx.strokeStyle=`hsl(${depth*30%360},70%,60%)`;
  ctx.lineWidth=depth;
  ctx.beginPath(); ctx.moveTo(x1,y1); ctx.lineTo(x2,y2); ctx.stroke();
  drawFractalTree(x2,y2,angle-Math.PI/6,depth-1);
  drawFractalTree(x2,y2,angle+Math.PI/6,depth-1);
}
function drawPage4(){
  ctx.fillStyle="rgba(0,0,0,0.1)"; ctx.fillRect(0,0,canvas.width,canvas.height);
  const baseX=canvas.width/2, baseY=canvas.height;
  const time=Date.now()/1000;
  drawFractalTree(baseX,baseY,-Math.PI/2+Math.sin(time)/4,10);
  raf=requestAnimationFrame(drawPage4);
}

// 5: 黄金比スパイラル
let t5=0;
function drawPage5(){
  ctx.fillStyle="rgba(0,0,0,0.05)"; ctx.fillRect(0,0,canvas.width,canvas.height);
  const phi=(1+Math.sqrt(5))/2;
  const centerX=canvas.width/2, centerY=canvas.height/2;
  for(let i=0;i<200;i++){
    const angle=i*0.3+t5;
    const radius=Math.pow(phi,i*0.05)*5;
    const x=centerX+radius*Math.cos(angle);
    const y=centerY+radius*Math.sin(angle);
    ctx.fillStyle=`hsl(${i*5 + t5*50%360},80%,60%)`;
    ctx.beginPath(); ctx.arc(x,y,4,0,Math.PI*2); ctx.fill();
  }
  t5+=0.02;
  raf=requestAnimationFrame(drawPage5);
}

// --- ページ切替 ---
function renderPage(){
  cancelAnimationFrame(raf);
  canvas.style.opacity=0;
  setTimeout(()=>{
    document.getElementById("pageId").innerText = page_id.toString().padStart(3,'0');
    if(page_id===0) drawPage0();
    else if(page_id===1) drawPage1();
    else if(page_id===2) drawPage2();
    else if(page_id===3) drawPage3();
    else if(page_id===4) drawPage4();
    else if(page_id===5) drawPage5();
    canvas.style.opacity=1;
  },200);
}

// --- キー操作 ---
document.addEventListener("keydown",(e)=>{
  if(e.key==='ArrowRight'){ page_id=(page_id+1)%6; renderPage(); }
  else if(e.key==='ArrowLeft'){ page_id=(page_id+5)%6; renderPage(); }
});

// 初回表示
renderPage();
</script>
</body>
</html>