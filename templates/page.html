<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>{{ "%03d"|format(page_id) }}</title>
    <style>
      body {
        margin: 0;
        font-family: sans-serif;
        background-color: black;
        color: white;
      }

      .header {
        display: flex;
        align-items: center;
        padding: 10px;
        font-size: 1.2em;
        cursor: pointer;
      }

      #backBtn {
        color: white;
        margin-right: 10px;
      }

      #piCanvas {
        display: block;
        margin: 0 auto;
        background-color: black;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <span id="backBtn">BACK</span>
      <span class="page-id">{{ "%03d"|format(page_id) }}</span>
    </div>

    <canvas id="piCanvas"></canvas>

    <script>
      document.getElementById("backBtn").addEventListener("click", function() {
        window.location.href = "{{ url_for('index') }}";
      });

      {% if page_id == 0 %}
        const canvas = document.getElementById("piCanvas");
        const ctx = canvas.getContext("2d");
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        let step = 0;

        const pi_digits = "14159265358979323846264338327950288419716939937510";

        function drawNext() {
          // 前のフレームを消す
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          const digit = parseInt(pi_digits[step]);
          const angle = digit * 36 * Math.PI / 180; // 0~9 → 0~324度
          const length = 200; // 固定長さで飛び出す

          const x = centerX + length * Math.cos(angle);
          const y = centerY + length * Math.sin(angle);

          ctx.strokeStyle = "white";
          ctx.lineWidth = 2;
          ctx.beginPath();
          ctx.moveTo(centerX, centerY);
          ctx.lineTo(x, y);
          ctx.stroke();

          step = (step + 1) % pi_digits.length; // 桁をループ
          requestAnimationFrame(drawNext);
        }

        drawNext();
      {% endif %}
    </script>
  </body>
</html>
